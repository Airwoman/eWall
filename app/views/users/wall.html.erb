<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
  <link rel="stylesheet" href="/assets/bootstrap.min.css" media="screen" title="no title" charset="utf-8">

  <script src="/assets/jquery-ui.js"></script>

</head>




</head>
<body>
  <div id="transfer" class="ui-widget-content ui-state-default">
    <ul id="pics">

    </ul>
  </div>
<div class="ui-widget ui-helper-clearfix">

<ul id="gallery" class="gallery ui-helper-reset ui-helper-clearfix">
  <% @current_user.stacks.each do |stack|%>
  <li class="ui-widget-content ui-corner-tr" id="<%= stack.id%>">
    <%= image_tag(stack.temp_photo.image, class: "img-circle img-responsive")%>
    <%= link_to 'Delete image', 'link/to/move', class:"ui-icon ui-icon-circle-arrow-n"%>
  </li>
  <% end %>
</ul>



</div>




<script>
$(document).ready(function(){
 $("#gallery").mouseover(function(){
   $(this).css({
     "bottom": "0",
     "-webkit-transition": "bottom 1s"
   });
 });
 $("#gallery").mouseout(function () {
   window.setTimeout(function () {
     $("#gallery").css({
       "bottom": "-15vh"
     });
   }, 10000);
 });

});





$(function() {
  // there's the gallery and the transfer
  var $gallery = $( "#gallery" ),
    $transfer = $( "#transfer" );

  // let the gallery items be draggable
  $( "li", $gallery ).draggable({
    cancel: "a.ui-icon", // clicking an icon won't initiate dragging
    revert: "invalid", // when not dropped, the item will revert back to its initial position
    containment: "document",
    helper: "clone",
    cursor: "move"
  });


  // let the transfer be droppable, accepting the gallery items
  $( "li", $gallery ).resizable({
    autoHide:true
  });
  $transfer.droppable({
    accept: "#gallery > li",
    activeClass: "ui-state-highlight",
    drop: function( event, ui ) {
      deleteImage( ui.draggable );
      stack_id = ui.draggable.attr('id');
      $.ajax({
        url: "/stacks/"+stack_id,
        type: "DELETE"
      }).done(function (data) {
        console.log(data);
      });
    }
  });

  // let the gallery be droppable as well, accepting items from the transfer
  $gallery.droppable({
    accept: "#transfer li",
    activeClass: "custom-state-active",
    drop: function( event, ui ) {
      // console.log(event);
      // console.log(ui);
      recycleImage( ui.draggable );
    }

  });


  function deleteImage($item) {
    var $li = $("<li></li>");
    var $pic = $("#pics");

    $item.find("img").appendTo ($li).appendTo ($pic);
    $item.remove();
    $("img",$transfer).resizable({
      autoHide:true,
      aspectRatio: true
    });
    $("div",$transfer).draggable({
      stack: 'div'
    });
  }

  // image recycle function
  var transfer_icon = "<a href='link/to/move' title='Delete this image' class='ui-icon ui-icon-circle-arrow-n'>Delete image</a>";
  function recycleImage( $item ) {
    $item.fadeOut(function() {
      $item
        .find( "a.ui-icon-refresh" )
          .remove()
        .end()
        .css( "width", "96px")
        .append( transfer_icon )
        .find( "img" )
          .css( "height", "72px" )
        .end()
        .appendTo( $gallery )
        .fadeIn();
    });
  }

  // image preview function, demonstrating the ui.dialog used as a modal window
  function viewLargerImage( $link ) {
    var src = $link.attr( "href" ),
      title = $link.siblings( "img" ).attr( "alt" ),
      $modal = $( "img[src$='" + src + "']" );

    if ( $modal.length ) {
      $modal.dialog( "open" );
    } else {
      var img = $( "<img alt='" + title + "' width='384' height='288' style='display: none; padding: 8px;' />" )
        .attr( "src", src ).appendTo( "body" );
      setTimeout(function() {
        img.dialog({
          title: title,
          width: 400,
          modal: true
        });
      }, 1 );
    }
  }

  // resolve the icons behavior with event delegation
  $( "ul.gallery > li" ).click(function( event ) {
    var $item = $( this ),
      $target = $( event.target );

    if ( $target.is( "a.ui-icon-circle-arrow-n" ) ) {
      deleteImage( $item );
    } else if ( $target.is( "a.ui-icon-zoomin" ) ) {
      viewLargerImage( $target );
    } else if ( $target.is( "a.ui-icon-refresh" ) ) {
      recycleImage( $item );
    }

    return false;
  });
});
</script>

</body>
</html>
