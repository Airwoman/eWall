<div class="panel-body g_g">
	<p id="notice"><%= notice %></p>
	<div class="pull-left">
		<div class="btn-group">
			<h2 class="panel-title">All Photos</h2>
		</div>
	</div>
	<div class="pull-right">
		<div class="btn-group">
			<%= link_to 'New Photo', new_photo_path, class: "btn btn-success btn-filter" %>
		</div>
		<div class="btn-group">
			<%= link_to 'Delete selected', photos_path, class: "btn btn-default" %>
		</div>
	</div>
</div>

<div class="ui-widget ui-helper-clearfix">

<ul id="group_gallery" class="group_gallery ui-helper-reset ui-helper-clearfix">
	<% @photos.each do |photo| %>
				<li class="ui-widget-content ui-corner-tr">
          <div class="imagewrap">
            <%= link_to image_tag(photo.image_url, class: "photo_list"), photo %>
            <input type="image" id="<%= photo.id%>" src="/assets/cross.png" class="delete">
          </div>
          <a href="link/to/delete" title="delete image" class="ui-icon ui-icon-closethick">Delete</a>
			    <a href="/assets/1.jpg" title="View larger image" class="ui-icon ui-icon-zoomin">View larger</a>
			    <a href="link/to/move" title="Move this image" class="ui-icon ui-icon-arrowthickstop-1-s">Move image</a>
          <%= link_to like_photo_path(photo), method: :post, remote: true do %>
            <i class="fa like-button <%= photo.likes.include?(@current_user) ? 'fa-heart' : 'fa-heart-o' %>" aria-hidden="true"></i>
          <%end %>
          <!-- <a href="" class="like" id = "<%= photo.id%>">
            <i class="fa fa-heart-o" aria-hidden="true"></i><%= photo.likes.count%>
          </a> -->


          <!-- <a href="#" class="comments" id = "<%= photo.id%>"><i class="fa fa-comments" aria-hidden="true"></i></a> -->
			  </li>

	<% end %>
</ul>

</div>
<div id="transfer" class="ui-widget-content ui-state-default">
	<h4 class="ui-widget-header">
    <span class="ui-icon ui-icon-arrowthickstop-1-s">
      Transfer Station
    </span> Transfer Station
  </h4>
</div>


<script>
$(document).ready(function(){
  $("#transfer").mouseover(function(){
   $(this).css({
     "bottom": "0",
     "-webkit-transition": "bottom 1s"
   });
 });

 $("#transfer").mouseout(function () {
   window.setTimeout(function () {
     $("#transfer").css({
       "bottom": "-15vh"
     });
   }, 10000);
 });

 $('.like-button').click(function() {
		$(this).toggleClass('fa-heart');
		$(this).toggleClass('fa-heart-o');
 });
});

$(function() {
  var $group_gallery = $( "#group_gallery" ),
      $transfer = $( "#transfer" );

  // let the group_gallery items be draggable
  $( "li", $group_gallery ).draggable({
    cancel: "a.ui-icon", // clicking an icon won't initiate dragging
    revert: "invalid", // when not dropped, the item will revert back to its initial position
    containment: "document",
    helper: "clone",
    cursor: "move",
		stop: function (event, ui) {
			var rexg=/(\/uploads(\/\w+)+.\w+)/;
			var imgsrc = ((ui.helper)[0].innerHTML).match(rexg);
			var new_img_url = imgsrc[0];
			var new_user_id = "<%= @current_user.id%>";
			var stack = { // save the data to transfer stack
        stack: {
					img_url: new_img_url,
					user_id: new_user_id
        }
			};
			$.ajax({
				url: "/stacks.json",
				type: "POST",
				data: stack
			}).done(function (data) {
				console.log(data);
			});
		}
  });

  // let the transfer be droppable, accepting the group_gallery items
  $transfer.droppable({
    accept: "#group_gallery > li",
    activeClass: "ui-state-highlight",
    drop: function( event, ui ) {
      MoveImageToTransfer( ui.draggable );
    }
  });

  // let the group_gallery be droppable as well, accepting items from the transfer
  $group_gallery.droppable({
    accept: "#transfer li",
    activeClass: "custom-state-active",
    drop: function( event, ui ) {
      recycleImage( ui.draggable );
    }
  });

  // put the image to transfer stack function
  var recycle_icon = "<a href='link/to/recycle/script/when/we/have/js/off' title='Recycle this image' class='ui-icon ui-icon-refresh'>Recycle image</a>";
  function MoveImageToTransfer( $item ) {
    $item.fadeOut(function() {
      var $list = $( "ul", $transfer ).length ?
        $( "ul", $transfer ) :
        $( "<ul class='group_gallery ui-helper-reset'/>" ).appendTo( $transfer );
      $item.find( "a.ui-icon-arrowthickstop-1-s" ).remove();
      $item.append( recycle_icon ).appendTo( $list ).fadeIn(function() {
        $item
          .animate({ width: "48px" })
          .find( "img" )
          .animate({ height: "36px" });
      });
    });
  $( "li", $group_gallery ).draggable();
  }

  // put the image back to group_gallery function
  var transfer_icon = "<a href='link/to/move' title='move this image' class='ui-icon ui-icon-arrowthickstop-1-s'>move image</a>";
  function recycleImage( $item ) {
    $item.fadeOut(function() {
      $item
        .find( "a.ui-icon-refresh" )
          .remove()
        .end()
        .css( "width", "96px")
        .append( transfer_icon )
        .find( "img" )
          .css( "height", "72px" )
        .end()
        .appendTo( $group_gallery )
        .fadeIn();
    });
  }

  // image preview function, demonstrating the ui.dialog used as a modal window
  function viewLargerImage( $link ) {
    var src = $link.attr( "href" ),
      title = $link.siblings( "img" ).attr( "alt" ),
      $modal = $( "img[src$='" + src + "']" );

    if ( $modal.length ) {
      $modal.dialog( "open" );
    } else {
      var img = $( "<img alt='" + title + "' width='384' height='288' style='display: none; padding: 8px;' />" )
        .attr( "src", src ).appendTo( "body" );
      setTimeout(function() {
        img.dialog({
          title: title,
          width: 400,
          modal: true
        });
      }, 1 );
    }
  }

  // resolve the icons behavior with event delegation
  $( "ul.group_gallery > li" ).click(function( event ) {
    var $item = $( this ),
      $target = $( event.target );

    if ( $target.is( "a.ui-icon-arrowthickstop-1-s" ) ) {
      MoveImageToTransfer( $item );
    } else if ( $target.is( "a.ui-icon-zoomin" ) ) {
      viewLargerImage( $target );
    } else if ( $target.is( "a.ui-icon-refresh" ) ) {
      recycleImage( $item );
    } else if ( $target.is( "a.ui-icon-closethick" ) ) {
      DeleteImage( $item );
    }

    return false;
  });



  //
  // function DeleteImage( $item ) {
  //   console.log($item);
  //   var photo_id = parseInt(this.id);
  //
  //   console.log(photo_id);
  //   $.ajax({
  //     url: "/photos/"+photo_id+".json",
  //     type: "DELETE"
  //   }).done(function () {
  //     $item.find( "a.ui-icon-arrowthickstop-1-s" ).remove();
  //   }).fail(function() {
  //     console.log("fail");
  //   });



      // $item.find( "a.ui-icon-arrowthickstop-1-s" ).remove();


  // }

  // $(".delete").on("click", function ($item) {
  //   var photo_id = parseInt(this.id);
  //
  //   console.log($item);
  //   $.ajax({
  //     url: "/photos/"+photo_id+".json",
  //     type: "DELETE"
  //   }).done(function () {
  //     $item.find( "a.ui-icon-arrowthickstop-1-s" ).remove();
  //   }).fail(function() {
  //     console.log("fail");
  //   });
  // });


});
</script>
